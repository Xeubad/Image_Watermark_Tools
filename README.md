# PicTools 图片水印添加工具

这是一个功能强大的图片水印添加工具，能够根据图片尺寸自动调整水印大小，支持中文水印文本，可以在图片的不同位置添加文本水印，支持随机位置和随机颜色，并保持原始目录结构。

## 功能特点

- 支持多种图片格式：PNG、JPG、JPEG、WebP、TIFF
- 自动调整水印文字大小，适应不同尺寸的图片
- 支持中文水印文本
- 提供5种水印位置选项（左上、右上、左下、右下、居中）
- 支持随机位置和随机颜色（默认）
- 支持同一文件夹内的图片使用相同颜色
- 保留原目录结构，输出目录与输入保持一致
- 自动处理文件名中的特殊字符
- 使用PIL库直接处理图片，无需依赖外部工具

## 安装要求

1. Python 3.6+
2. 安装所需依赖：
   ```
   pip install pillow
   ```
3. 准备一个支持中文的字体文件，放在`fonts`目录下

## 使用方法

```
PicTools.exe 输入目录 [水印文字] [位置] [颜色] [同文件夹同颜色]
```

### 参数说明

- **输入目录**: 必填，包含要处理图片的目录路径
- **水印文字**: 可选，要添加的水印文本，默认为"默认水印"
- **位置**: 可选，水印位置参数，默认为"random"(随机)
  - `1`: 左上角
  - `2`: 右上角
  - `3`: 左下角
  - `4`: 右下角
  - `5`: 中央
  - `random`: 随机位置(默认)
- **颜色**: 可选，水印颜色参数，默认为"random"(随机)
  - `red`: 红色
  - `yellow`: 黄色
  - `green`: 绿色
  - `orange`: 橙色
  - `random`: 随机颜色(默认)
- **同文件夹同颜色**: 可选，是否同一文件夹使用相同颜色，默认为"yes"
  - `yes`: 是(默认)
  - `no`: 否

### 输出说明

处理后的图片将保存在与输入目录同级的新目录中，命名格式为：`原目录名_水印文字`

例如，如果输入目录为`D:\Photos`，水印文字为"版权所有"，则输出目录为`D:\Photos_版权所有`

输出目录中会保持与原目录相同的子目录结构。

### 示例

```bash
# 默认设置 - 随机位置、随机颜色、同文件夹同颜色
PicTools.exe D:\Photos "版权所有"

# 固定位置(中央)、随机颜色、同文件夹同颜色
PicTools.exe D:\Photos "版权所有" 5

# 随机位置、固定颜色(绿色)
PicTools.exe D:\Photos "版权所有" random green

# 随机位置、随机颜色、禁用同文件夹同颜色(每张图片颜色都随机)
PicTools.exe D:\Photos "版权所有" random random no
```

## 同文件夹同颜色功能

默认情况下，程序会为每个包含图片的文件夹分配一个随机颜色，同一文件夹内的所有图片会使用相同的颜色。这样处理后的水印在保持随机性的同时也有组织性，每个文件夹的图片有统一的风格。

如果你想让每张图片都使用完全随机的颜色，可以在命令中添加`no`参数：

```bash
PicTools.exe D:\Photos "版权所有" random random no
```

## 目录结构

```
/
├── PicTools.exe      # 打包后的可执行文件
├── fonts/            # 字体文件目录
│   └── ChillDuanHeiSongPro_Regular.otf  # 示例中文字体
└── [输入目录]         # 用户指定的输入目录
```

## 自定义配置

如果需要修改默认配置，可以编辑源代码中的以下部分：

```python
# 水印颜色选项
COLORS = {
    "红色": "#FF0000",
    "黄色": "#FFFF00",
    "绿色": "#00FF00",
    "橙色": "#FFA500"
}

# 字体大小计算
def get_optimal_font_size(img_width, img_height):
    diagonal = (img_width**2 + img_height**2)**0.5
    font_size = int(diagonal * 0.03)  # 这里的0.03可以调整
    return max(40, min(font_size, 300))  # 最小40，最大300
```

## 技术说明

- 使用PIL(Pillow)库进行图片处理和水印添加
- 水印大小根据图片对角线长度的3%自动计算
- 文字大小限制在40-300像素之间，确保在大小图片上都清晰可见
- 递归处理目录和子目录中的所有支持格式图片
- 自动创建与原目录结构一致的输出目录
- 支持为同一文件夹内的图片使用统一的水印颜色
- 通过随机位置和随机颜色增加水印的多样性

## 注意事项

1. 确保`fonts`目录中有支持中文的字体文件，否则中文可能显示为方块
2. 水印文字大小根据图片对角线长度的3%计算，可通过修改`get_optimal_font_size`函数调整比例
3. 最小字体大小为40，最大为300，可根据需要在代码中调整
4. 如果图片尺寸过小，水印可能不清晰或超出图片范围
5. 如果启用同文件夹同颜色功能，程序会为每个文件夹预先分配颜色

## 故障排除

- 如果出现"字体文件不存在"错误，请检查字体文件路径是否正确
- 如果水印文字显示为方块，请确保使用的字体支持中文
- 如果水印太大或太小，可调整`get_optimal_font_size`函数中的系数（默认0.03）
- 如果输出路径过长导致错误，请使用更短的水印文字或调整输入目录层级
- 如果使用随机颜色模式但颜色没有变化，请检查是否启用了"同文件夹同颜色"功能

## 后续开发计划

- 增加半透明水印选项
- 支持图片水印模式
- 增加批处理模式，支持多目录同时处理
- 添加水印效果预览功能
- 增加GUI界面，使操作更加直观

## 许可证

本工具为开源软件，可自由使用和修改。
